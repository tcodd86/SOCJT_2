\documentclass{article}

%\usepackage[dvips]{rotating,epsfig}
\usepackage{longtable}
\usepackage{overcite}
\usepackage{amstext}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{verbatim}
%\usepackage{afterpage}
%\usepackage{mcite}
%\usepackage{psboxit}

%\PScommands

\special{papersize=8.5in,11in}
\setlength{\textwidth}{6.5in}
\setlength{\textheight}{9.0in}
\setlength{\hoffset}{-0.75in}
\setlength{\voffset}{-0.75in}

\special{papersize=8.5in,11.5in}

\newcommand{\wn}{cm$^{-1}$}
\newcommand{\XtildeE}{$\widetilde{X}\,^2$E\ }
\newcommand{\XtildeA}{$\widetilde{X}\,^2\!$A$_1$\ }
\newcommand{\AtildeE}{$\widetilde{A}\,^2$E\ }
\newcommand{\AtildeA}{$\widetilde{A}\,^2\!$A$_1$\ }
\newcommand{\ItildeA}{$\widetilde{I}^+\,^1\!$A$_1$\ }
\newcommand{\AadoubleXe}{\AtildeA $\leftrightarrow $ \XtildeE }
\newcommand{\AasingleXe}{\AtildeA $\leftarrow $ \XtildeE }
\newcommand{\IasingleAe}{\ItildeA $\leftarrow $ \AtildeE }
\newcommand{\ai}{{\it ab initio}}
\newcommand{\Xzero}{${\bf X_0}$}
\newcommand{\xone}{${\bf x_1}$}
\newcommand{\xtwo}{${\bf x_2}$}
\newcommand{\xd}{${\bf x_d}$}
\newcommand{\Xmin}{${\bf X_{\min }}$}
\newcommand{\Xmax}{${\bf X_{\max }}$}
\newcommand{\xmax}{${\bf x_{\max }}$}
\newcommand{\JT}{Jahn-Teller\ }
\newcommand{\Xa}{{\bf Xa}}
\newcommand{\Xb}{{\bf Xb}}
\newcommand{\Xc}{{\bf Xc}}
\newcommand{\ddelta}{d$\delta $}
\newcommand{\ddeltastar}{d$\delta ^*$}
\newcommand{\dsigma}{d$\sigma $}
\newcommand{\dsigmastar}{d$\sigma ^*$}
\newcommand{\dpi}{d$\pi $}
\newcommand{\dpistar}{d$\pi ^*$}
\newcommand{\ul}{\underline }
\renewcommand{\o}{CF$_3$O}
\newcommand{\s}{CF$_3$S}
\newcommand{\socjttwo}{{\bf SOCJT 2}}
\newcommand{\socjt}{{\bf SOCJT}}
\newcommand{\socrt}{{\bf SOCRT}}
\newcommand{\etoe}{{\bf e2e}}
\newcommand{\pitopi}{{\bf pi2pi}}

\newenvironment{bulletlist}{%
  \renewcommand{\labelitemi}{$\bullet $}%
     \begin{itemize}}{\end{itemize}}

\renewcommand{\baselinestretch}{1}

\setlength{\LTcapwidth}{6in}
\renewcommand{\marginparwidth}{0.5in}

\begin{document}

\author{Terrance Codd}
\title{Users Manual for \socjttwo}

\date{\today}

\maketitle

%\newpage
\tableofcontents
%\newpage
%\listoffigures
%\newpage
%\listoftables
\newpage

\setcounter{section}{-1}
\section{Preface} \label{section:preface}

The program \socjttwo\ has the following
capabilities: 
\begin{bulletlist}
\item Find the lowest energy solutions to the Jahn-Teller Hamiltonian, including linear and quadratic terms as well as bilinear coupling terms between Jahn-Teller active and inactive modes, and spin-orbit coupling, for any molecule in a non-cubic point group.
%\item Compute a number of properties of the state using the eigenvectors, including Coriolis coupling constants and the relative vibronic transition intensities between the Jahn-Teller active state
%  and a non-degenerate state, or another Jahn-Teller active state.
\item Any number of Jahn-Teller active and inactive modes can be accommodated, as well as an arbitrary spin state, whether half-integer or integer.
\item A non-linear least squares routine is available for the fitting of the parameters to experimental data.
\item Generate scans of one or more parameters automatically.
\end{bulletlist}

\begin{comment}
The following files are included in the distribution file {\tt
  socjt.zip}: 
\begin{description}
\item[{\tt socjt.exe}] Executable file for the main program,
  \socjt, to be run from a MS-DOS prompt.
\item[{\tt socrt.exe}] Executable file for the Renner-Teller
  version, \socrt .
\item[{\tt e2e.exe}] Executable file for the calculation of
  electronic transition intensities from one \JT\ active state to
  another.
\item[{\tt pi2pi.exe}] Executable file for the calculation of
  electronic transition intensities from one Renner-Teller active
  state to another. This file is not yet available.
\item[{\tt inputasst.exe}] Executable file that creates an input
  file for {\tt socjt.exe } based on the answers to a series of
  questions.
\item[{\tt test1}] Plain text input file to test \socjt.
\item[{\tt test2}] Plain text input file to test \socjt. The output
  of the files {\tt test1} and {\tt test2} can be used as input for
  \etoe .
\item[{\tt rt\_test}] Plain text input file to test \socrt .
\item[{\tt e2e\_test}] Plain text input file to test \etoe .
\item[{\tt manual.tex, manual.ps, and manual.pdf}] The users guide for
  the suite of programs. 
\item[{\tt output.zip}] All of the output files that are generated by
  running the test files. 
\end{description}
\end{comment}

\newpage

\section{Introduction} \label{section:intro}

The Jahn-Teller effect is by now quite old and over a thousand papers
have been published on \JT\ related molecules.  While many of these
papers are on distortions of \JT\ molecules in solid-state crystal
structures, an ever increasing number of high resolution, gas-phase
measurements of \JT\ active states of molecules are being obtained in
the laboratory. The high quality of this data, free of perturbations
by extra-molecular interactions, has revealed the true complexity of
the \JT\ problem. Of particular importance to our research has been
the fact that nearly all \JT\ active states so far observed have been
open shell systems, which in principle all have first-order
spin-orbit coupling, except for the somewhat rare open shell singlet
states. \socjt\ was developed by Timothy Barckholtz and Terry Miller for the analysis of the spectroscopic data for \JT\ molecules. The most recent version of \socjt\ is now over ten years old and has some limitations which are the motivation for the development of \socjttwo.

This manual describes the use and background of \socjttwo\ and is a (slightly) modified version of the manual written for \socjt\ by Timothy A. Barckholtz and Terry A. Miller.
The program \socjttwo\ (an an acronym for {\ul S}pin-{\ul O}rbit {\ul C}oupling
and {\ul J}ahn-{\ul T}eller; pronounced ``sock-it'') diagonalizes the
spin-vibronic portion of the Jahn-Teller Hamiltonian, which produces
the energies and eigenvectors of the spin-vibronic levels of the
state.

\begin{comment}
Besides diagonalizing the spin-vibronic Hamiltonian, the programs
\socjt\ and \socrt\ calculate several properties of the system. All of
these properties are detailed later in section \ref{section:output}.
One of the most important items calculated by \socjt\ is the relative
intensities of the vibronic transitions involved in an electronic
transition to and from the degenerate state. These calculations assume
diagonal Franck-Condon factors, and only the intensities of
progressions of the Jahn-Teller active modes are computed. In the main
\socjt\ and \socrt\ programs, it is assumed that the non-Jahn-Teller
active state involved in the electronic transition is a singly
degenerate or non-Jahn-Teller active degenerate state.
\end{comment}

This program was written by Terrance Codd between 2011 and 2014 while
a graduate student at The Ohio State University, advised by Terry
Miller. It was written in C\# and therefore requires either the .NET framework (Windows) or Mono (OSX and Linux) to run.  Most tests were performed using .NET framework 4.0 on two quad-core Xenon processors with 4 GB of RAM running 64-bit Windows 7 Enterprise.  Some testing with \socjttwo\ has been done on MNode1, a linux cluster running Red Hat Enterprise 6.1 Linux using Mono 3.2.1.
\begin{comment}
A version for the Cray
operating system is available upon request, as is the source code for
the DOS versions. This program should be cited as: Barckholtz, T. A.;
Miller, T. A.  {\it Int. Rev. Phys. Chem.}, {\bf 1998}, {\it 17},
435-524.
\end{comment}

\subsection{Program limitations.} \label{section:limitations}
\socjttwo, by design, suffers many, though not all, of the limitations of \socjt which are described below.

\begin{bulletlist}
\item \socjttwo\ cannot handle degeneracies greater than two; i.e., it
  does not work for the cubic point groups. It also may not
  work for molecules with a $C_4$ axis. %; see the discussion of these
  %point groups in references \citen{barckholtz} and \citen{jttheory20}.
\item The program can only properly handle one type of \JT\ active
  mode, with respect to the values of $s_2$. Examination of
  Table 3 of reference \citen{barckholtz} shows that it is possible to have
  a state with more than one symmetry of quadratic linear \JT\ active
  modes. In this case, they may have a different value of
  $s_2$. However, only one value of $s_2$ is allowed as input in the
  program. The ramification of this is that the energies will be
  calculated accurately, but the Coriolis coupling constants will
  likely be erroneously computed. This case should be fairly rare, and
  I have not considered this possibility extensively.
\item \socjttwo\ has been tested against \socjt\ for the C$_{3\textnormal{v}}$/D$_{3\textnormal{h}}$ case, and
  is believed to be accurate for all other non-cubic point groups.
\end{bulletlist}

\section{The Jahn-Teller Effect} \label{section:jt}

Before describing the input and output of \socjttwo, we briefly summarize
the Jahn-Teller effect, which serves several purposes. The \JT\ effect
is over 75 years old, and numerous different approaches have been
taken in the analysis of the vibronic structure of \JT\ active
molecules. There thus exists a wide variety of notations and
nomenclatures for all of the different parameters and effects involved
in the problem. This section outlines our approach and summarizes the
most important aspects of the problem. For a full description, we
refer the reader to the masterwork on this problem, reference
\citen{barckholtz}.

\subsection{Basis set.} The basis set used to compute the vibrational 
structure of Jahn-Teller states is a product of electronic, vibrational,
and spin functions. At the symmetric configuration of the nuclei, 
the electronic wavefunction is degenerate and we use the label
$\Lambda = \pm 1$ to distinguish between the 
two complex components of the $^2$E electronic wavefunction E$_\pm$. 
We multiply the electronic basis set by the harmonic oscillator basis
functions for the $p$ two-dimensional Jahn-Teller active modes and the
$3N-6-2p$ harmonic oscillator basis functions for the non-Jahn-Teller
active modes. The vibrational portion of the basis set is
characterized by the principal vibrational quantum number $v_i$ and
the angular vibrational quantum number $l_i$ for each \JT\ active mode.
To include spin-orbit coupling in the calculation,
a ket characterized by the projection, $\Sigma $, of ${\bf S}$ on the 
symmetry axis is appended to the basis set.

Only some vibrational modes of a Jahn-Teller active molecule will show
the effects of $k^{th}$-order \JT\ coupling. In their mammoth paper
describing this 
project, Barckholtz and Miller derived a general method for determining which vibrational
modes will be \JT\ active. For a given vibrational mode of symmetry
$e_{s_v}$ and  a given electronic state of symmetry $E_{s_e}$, a value
for $s_k$ of either 0 or 1 can be chosen to satisfy the equation
\begin{equation}
\left( 2s_e + (-1)^{s_k } ks_v \right) \text{ mod } n=0,
\label{se and sv selection rule}
\end{equation}
which means the quantity $\left( 2s_e \pm ks_v \right) $
must be an integer multiple of $n$, where $n$ is the order of the
principal axis of the molecule. The only variable in equation (\ref{se
  and sv selection rule}) is $s_k$, and the values of $s_k$ ($k=1$ and 2)
are required input to \socjttwo. The reader should refer to Table 2 of
reference \citen{barckholtz} for guidance in choosing values for $s_1$ and
$s_2$. See also section \ref{section:limitations} for some
restrictions on these quantities.

\subsection{Hamiltonian.} The Hamiltonian for the molecule is the sum of a number of terms, 
\begin{equation}
\hat{\cal H}=\hat{\cal H}_{T}+\hat{V}+\hat{\cal H}_{SO},
\label{overall Hamiltonian}
\end{equation}
where $\hat{\cal H}_{T}$ is the kinetic energy of the nuclei. 
The sum of $\hat{\cal H}_T$ and the potential $\hat{V}$ define
the potential energy surface (PES). We refer the reader to our 
previous papers\cite{c6f6review,barckholtz} on this topic for the
terms of the power series expansion of the potential 
$\hat{V}$. For our
purposes here, it suffices to say that the potential has, in addition
to the standard harmonic oscillator terms for the degenerate modes,
terms linear and quadratic in the vibrational coordinates of the
degenerate modes that account
for linear and quadratic Jahn-Teller coupling. 
The experimentally observed spin-vibronic energy levels of an \XtildeE\
states can be viewed as the eigenvalues of the nuclear
motion defined on a PES determined by $\hat{V}$ and $\hat{\cal H}_{SO}$.

\subsection{PES and definition of customary Jahn-Teller parameters.} 
The customary parameters that are used to characterize the 
PES are defined in the following way. The spin-orbit 
Hamiltonian $\hat{\cal H}_{SO}$ is parameterized by the product $a\zeta _e$,
where $\zeta _e$ is the projection of the electronic orbital angular
momentum on the $C_3$ axis and $a$ is the spin-orbit coupling constant.
The remaining parameters of the PES can most easily be defined by noting 
that, in the limit $a\zeta _e\rightarrow 0$, the form of the potential
$\hat{V}$ along the $i^{th}$ normal coordinate is
\begin{eqnarray}
  &U_{i,\pm }= \frac12 \lambda _i \rho _i^2 \pm \rho _i k_i
   \left[ 1 + \frac{2g_{ii}\rho _i}{k_i}\cos 3\phi _i + 
   \frac{g_{ii}^2\rho _i^2}{k_i^2} \right]^{\frac12} &\\
  &\approx \frac12 \lambda _i \rho _i^2 \pm \left( k_i \rho _i + 
  g_{ii}\rho _i^2 \cos 3\phi _i \right) ,& 
\label{U, no spin orbit}
\end{eqnarray}
where in the last equality the expansion of the radical has been
truncated at terms quadratic in $\rho _i$. In these equations, cylindrical 
coordinates $\rho _i$ and $\phi _i$ have been used for i$^{th}$ degenerate
normal mode that is Jahn-Teller active. 
The energies of the minima and maxima along this coordinate are given by
\begin{eqnarray}
&E_{\min ,i} =-\frac{k_{i}^{2}}{2\lambda _{i}(1-K_{i})}=-\frac{D_{i}\omega
_{e,i}}{(1-K_{i})}\approx -D_{i}\omega _{e,i}(1+K_{i})&
\label{E min, no spin orbit} \\
&\rho _{\max ,i} =\frac{k_{i}}{\lambda _{i}(1+K_{i})};
\phi _{\max ,i} = \frac{\pi }{3}, \pi , \frac{5\pi}{3}&
\label{rho max, no spin orbit} \\
&E_{\max ,i} =-\frac{k_{i}^{2}}{2\lambda _{i}(1+K_{i})}=-\frac{D_{i}\omega
_{e,i}}{(1+K_{i})}\approx -D_{i}\omega _{e,i}(1-K_{i})\text{,}&
\label{E max, no spin orbit}
\end{eqnarray}
where $D_{i}$ is the linear Jahn-Teller coupling constant for the $i^{th}$ 
mode and $K_{i}$ is its quadratic Jahn-Teller coupling constant. Both 
of these coupling constants are dimensionless.

The energies of Eqs. \ref{E min, no spin orbit} and \ref{E
max, no spin orbit} are relative to the symmetric configuration, which 
is defined as the zero of energy. The depth, $\epsilon ^{(1)}$, of the moat is the
linear Jahn-Teller stabilization energy and is a direct measure of the net
effect the Jahn-Teller coupling has on the energy of the
molecule. From Eqs. \ref{E min, no spin orbit} and \ref{E max,
  no spin orbit}, the stabilization energy due to linear Jahn-Teller
coupling is obtained by setting $K_i=0$ and taking the difference,
which yields
\begin{equation}
\epsilon _i^{(1)} = D_i \omega _{e,i}. 
\label{def of epsilon1}
\end{equation}
The additional stabilization due to quadratic Jahn-Teller coupling in
the mode, $\epsilon _i^{(2)}$, is
\begin{equation}
\epsilon _i^{(2)} = D_i \omega _{e,i} K_i. \label{def of epsilon2}
\end{equation}
The barrier to pseudorotation about the moat is then $2D_i \omega
_{e,i} K_i$.

A common approximation is that the Jahn-Teller stabilization 
energy in the state is a sum of the Jahn-Teller effect in the individual 
modes. Under this assumption, the total Jahn-Teller stabilization energy
is a sum over the individual Jahn-Teller stabilization energies,
\begin{equation}
\epsilon _{total} = \sum\limits _i \left[ D_i \omega _{e,i} 
\left( 1 + K_i \right) \right] .
\end{equation}

When spin-orbit coupling is non-negligible, the stabilization energy 
along the $i^{th}$ coordinate is decreased by the presence of spin-orbit
coupling to\cite{barckholtz}
\begin{equation}
-\epsilon _i^{so}=
\left\{ 
\begin{array}{ll}
-D_{i}\omega _{e,i}+\frac{\left( a\zeta _{e}\right) ^{2}}{16D_{i}\omega
_{e,i}} & ,a\zeta _{e}<4D_{i}\omega _{e,i} \\ 
0 & ,a\zeta _{e}\geq 4D_{i}\omega _{e,i}
\end{array} 
\right.  \label{E min, with soc} 
\end{equation}
The total Jahn-Teller stabilization energy is then a sum over all of
the individual stabilization energies of Eq. \ref{E min, with soc}.

\subsection{The Jahn-Teller quantum numbers $j^{(k)}$}

As the Taylor expansion of the \JT\ Hamiltonian is increased, the
number of conserved quantum numbers is decreased. Elsewhere\cite{barckholtz}
we derived the following general form of the ``good'' \JT\ quantum
number, $j^{(k)}$ for the $k^{th}$-order term of the \JT\ Hamiltonian,
\begin{equation}
j^{(k)}=\frac{1}{k}l_t+ \frac12 (-1)^{s_k }\Lambda ,
\label{general form of j}
\end{equation}
where $s_k$ is chosen according to equation (\ref{se and sv selection
  rule}). The specific relationships between $j^{(k)}$, $l_t$, and
$\Lambda $ are given in Table 2 of reference \citen{barckholtz} for the
common point groups. The user's choice of $s_1$ and $s_2$ in the input
file dictate the definition of $j^{(1)}$ and $j^{(2)}$, according to
equation (\ref{general form of j}). 
In most circumstances the superscript $^{(k)}$ is
dropped, and a value of $k=1$ is assumed. This is the custom used in
the remainder of this manual and in the program itself.

\subsection{Eigenvectors.} The general form for the eigenfunctions 
$\left| j,n_{j},\alpha ,\Sigma \right\rangle $ is 
\begin{equation}
\left| j,n_{j},\alpha ,\Sigma \right\rangle =\sum_{i}\left( c_{i,n_{j},\Sigma }\left|
\Lambda _{i}\right\rangle 
\prod\limits_{m=1}^{p}\left| v_{m,i},l_{m,i}\right\rangle
\prod\limits_{n=1}^{3N - 6 - 2p}\left| v_{n,i}\right\rangle
 \left| \Sigma _i \right\rangle 
\right), \label{eigenvector notation}
\end{equation}
where the summation runs over all of the basis functions used in the
calculation. Each eigenvector $\left| j,n_{j},\alpha ,\Sigma \right\rangle $
has an associated eigenvalue $E_{j,n_{j},\Sigma }$. The notation $\left|
j,n_{j},\alpha ,\Sigma \right\rangle $ indicates which $j$-block the level
corresponds to and which eigenvector, $n_{j}$, it is from that symmetry
block (corresponding to a given $j$ -- different $j$ mod 3 when
quadratic coupling is included -- and $\Sigma$ combination), with the
lowest energy solution of each symmetry block being $n_{j}=1$.  
Because $j$
is not always a good quantum number, we have included into the ket the label 
$\alpha $, which is the symmetry species 
of the state. Note that there are now two subscripts on the quantum numbers $\nu $ and $l$
in the basis functions of equation (\ref{eigenvector notation}). 
The first, $m$ or $n$, corresponds to which vibrational
mode the quantum number refers while the second, $i$, represents the basis
function to which the quantum number belongs. 

The quantum number $\Sigma $ is
included in the summation only when spin-orbit coupling is included in the Hamiltonian;
in its absence, equation (\ref{eigenvector notation}) becomes
\begin{equation}
\left| j,n_{j},\alpha \right\rangle \left| \Sigma \right\rangle =
\sum_{i}\left( c_{i,n_{j} }\left| \Lambda _{i}\right\rangle 
\prod\limits_{m=1}^{p}\left| v_{m,i},l_{m,i}\right\rangle  
\prod\limits_{n=1}^{3N - 6 - 2p}\left| v_{n,i}\right\rangle
\right) 
\left| \Sigma \right\rangle . \label{eigenvector notation without sigma}
\end{equation}
In the two limits of small spin-orbit coupling or large Jahn-Teller coupling
the spin-vibronic wavefunction is approximately identical to the
vibronic wavefunction, i.e.,  
$\left| j,n_{j},\alpha \right\rangle \left| \Sigma \right\rangle \approx 
\left| j,n_{j},\alpha ,\Sigma \right\rangle $.
At these limits, the two components of the spin-orbit doublet have
identical vibronic wavefunctions and PES's. Depending on the choice of
input parameters (i.e., a zero or non-zero value of $a\zeta _e$), the
output of the eigenvectors will be in the form of either equation
(\ref{eigenvector notation}) or (\ref{eigenvector notation without sigma}).

%\subsection{Ham reduction factor.} An important feature of the \socjt\ program is that it has the capability of directly including spin-orbit coupling along with \JT\ coupling in the Hamiltonian. Prior to this program, nearly all Jahn-Teller calculations in the literature have added spin-orbit coupling to the linear Jahn-Teller Hamiltonian ``after the fact'' via a formula initially derived by Child and Longuet-Higgins.\cite{jttheory9} The formula is derived by taking the expectation value of $\hat{\cal H}_{SO}$ for the vibronic eigenfunction, computed without including $\hat{\cal H}_{SO}$ in the Hamiltonian: 
%\begin{equation}
%\left\langle \Sigma \right|
%\left\langle j,n_{j},\alpha \right| \hat{\cal H}_{SO}
%\left| j,n_{j},\alpha \right\rangle \left| \Sigma \right\rangle
%=a\zeta _{e}d_{j,n_{j}}\Sigma \text{, where
%  }d_{j,n_{j}}=\sum_i\Lambda 
%_ic_{i,n_{j}}^{2}.  \label{ham parm definition}
%\end{equation}
%The parameter $d_{j,n_{j}}$ is often called the Ham reduction factor and is usually
%not given with subscripts. However, because each
%vibronic level has a unique value of $d$, we feel it is appropriate to
%assign subscripts to this parameter to identify the eigenfunction to which
%it corresponds. From this formula, the approximate spin-orbit
%splitting, $\Delta E_{j,n_j}^{SO}$ of the $n_{j}^{th}$ energy level of
%the $j^{th}$ symmetry block is  
%\begin{equation}
%\Delta E_{j,n_{j}}^{SO}= E_{j,n_j,\Sigma = +\frac12 } - 
%E_{j,n_j,\Sigma = -\frac12 } = a\zeta _{e}d_{j,n_{j}}.  \label{azetad2}
%\end{equation}
%The quantity $d_{j,n_{j}}$ is contained in the output for each
%eigenvalue and eigenvector computed. These values are printed even
%when spin-orbit coupling or quadratic \JT\ coupling is included in the
%calculation. In these cases, the Ham reduction factor may have little
%relevance to the observed energy levels, and the actual computed
%energies should be used instead of the energies calculated by equation
%(\ref{azetad2}). 

%\subsection{Coriolis and spin-rotation parameters.} 
%One last quantity remains to be defined, and that is the Coriolis
%coupling constant, which is defined by the Coriolis Hamiltonian,
%\begin{equation}
%\hat{\cal H}_{COR} = -2A \left( \hat{L}_z + \hat{G}_z \right)
%\hat{N}_z .
%\label{HCOR}
%\end{equation}
\begin{comment}
As we discussed in detail elsewhere,\cite{barckholtz,tab11} the Coriolis
coupling has a strong dependence on the spin-orbit coupling, and is
quite closely related to the spin-rotation parameter $\epsilon
_{aa}$. We present only the results of our derivations of the
following equations and refer the reader to the original
paper\cite{barckholtz} for details. 

The expectation value $\zeta _t$ of  $\hat{\cal H}_{COR}$ over the
eigenfunction for a given degenerate vibronic level, in the absence of
spin-orbit coupling, is 
\begin{eqnarray}
\hat{\cal H}_{COR}
&=&-2A\left\langle j,n_{j},\alpha =e\right| \hat{L}_z + \hat{G}_z
\left| j,n_{j},\alpha =e\right\rangle \hat{N}_z   \label{Hcor evaluation line 1} \\
&=&-2A\zeta _{t} \hat{N}_z,  \label{Hcor evaluation line 2} \\
\text{where }\zeta _{t} &=&\sum_{i}\left[ c_{i,n_j}^{2}\left( \Lambda _{i}\zeta
_{e}+\sum\limits_{m=1}^{p}l_{m,i}\zeta _{m}\right) \right] ,
\label{Hcor evaluation line 3}
\end{eqnarray}
where $\zeta _{e}$ is the electronic orbital angular momentum and
$\zeta _{i}$ is the Coriolis coupling constant for the $i^{th}$
vibrational mode.

With non-zero spin-orbit coupling, equation (\ref{Hcor evaluation line
  3}) becomes 
\begin{eqnarray}
\hat{\cal H}_{COR}
&=&-2A\left\langle j,n_{j},\alpha =e,\Sigma \right| \hat{L}_z + \hat{G}_z
\left| j,n_{j},\alpha =e,\Sigma \right\rangle \hat{N}_z  \\ 
&=&-2A\zeta _{t}^\Sigma  \hat{N}_z,  \\
\text{where }\zeta _{t}^\Sigma  &=&\sum_{i}\left[ c_{i,n_j,\Sigma
    }^{2}\left( \Lambda _{i}\zeta
    _{e}+\sum\limits_{m=1}^{p}l_{m,i}\zeta _{m}\right) \right] .
\label{Hcor with spin}
\end{eqnarray}
The difference between the Coriolis constant for each spin component,
$\Delta \zeta _t^\pm $, is
\begin{equation}
\Delta \zeta _t = \zeta _t^+ - \zeta _t^-,
\label{delta zeta spin}
\end{equation}
where the signs correspond to the sign of $\Sigma = \pm \frac12 $. The
two Coriolis constants will be approximately related by
\begin{equation}
\zeta _t^\pm = \zeta _t^0 \pm \frac12 \Delta \zeta _t , \label{zetaspinrot}
\end{equation}
where $\zeta _t^0$ denotes the Coriolis coupling
constant that would result if there were no spin-orbit coupling; i.e.,
a Coriolis coupling constant corresponding to equation 
(\ref{Hcor evaluation line 3}).
As derived elsewhere,\cite{barckholtz} the difference in the two Coriolis
coupling constants is related to the spin-rotation interaction by the equality
\begin{equation}
\frac{\epsilon _{aa}^{2v}}{2A} = -\Delta \zeta _t ,
\label{deltazetaepsilonaa}
\end{equation}
where $A$ is the rotational constant about the primary axis of the molecule.

For each eigenvalue and eigenvector computed, a value of $\zeta _t$ is
computed by either equation (\ref{Hcor evaluation line 3}) or 
(\ref{Hcor with spin}), which allows the quantities $\Delta \zeta _t $
and then $\frac{\epsilon _{aa}^{2v}}{2A}$ to be computed.
\end{comment}

\section{Input} \label{section:input}

The input file is organized into sets of namelist groups, each of
which is begun by a \&NAMELIST command and ended with a forward slash
\/, as in 
\begin{verbatim}
 &GENERAL 
  nmodes = 1
  AZETA = 950.
  MAXJ = 1.5
  TITLE = cdch3 
  /
\end{verbatim}
Within each \&NAMELIST the input variables are assigned their initial
values, and separated by returns, spaces or tabs. Each \&NAMELIST group is separated from
the previous by a '/'. C\# does not suffer the same weaknesses of FORTRAN for file I/O
so the number of spaces and alignment of decimals for the input parameters is unimportant.
Where a boolean value is required \socjttwo\ checks for a {\tt T} or {\tt TRUE} (in upper or lower case)
and if that is not found the default value of {\tt FALSE} is used. Any input files for \socjt\ will work
with \socjttwo. However, there are some capabilities in \socjt\ not included in \socjttwo\ such as 
computation of spectra and those sections will be ignored. The order of the variables in
the \&NAMELIST does not matter, nor does the order of the \&NAMELIST
groups in the input file itself. Order only comes into play for the {\tt \&MODE\_INFO} namelists as they will be labeled numerically based upon their order in the input file.

The \&NAMELIST groups are separated by their function. There will be one each of
{\tt \&GENERAL}, {\tt \&SOLVE\_INFO} and {\tt \&IO\_INFO}. There will be as many {\tt \&MODE\_INFO} groups as there are active modes
(specified by the variable {\tt NMODES}  in {\tt \&GENERAL}). If any group is not included,
a default set of parameters will be used. The {\tt \&FIT\_INFO}, {\tt \&SCAN} and {\tt \&CROSS\_TERMS} 
may be left out when unneeded. If more than one
\&NAMELIST group, except for {\tt \&MODE\_INFO}, is included in the input file the values from the second will overwrite the those from the first. 

BEWARE: There is only some error checking in the input file. It is
quite possible that the ``garbage in garbage out'' principle
applies. The values which are explicitly checked for correctness are noted below in their description. Where a numerical value is needed, such as for {\tt AZETA}, a check is done to ensure that it is a number and if it is not, an error is thrown but there are no sanity checks to see that it is a physically reasonable value.
\newpage
\subsection{\&GENERAL}

The {\tt \&GENERAL} namelist group sets the general parameters for the
calculation. The default values are

\begin{verbatim}
 &GENERAL 
  NMODES = 1
  TITLE = TITLE
  S = 0.5
  AZETA = 0.0
  FIT_AZETA = FALSE
  MAXJ = 7.5
  FIT_ORIGIN = FALSE
  ORIGIN = 0.0
  USE_KAPPA_ETA = FALSE
  S1 = 0
  S2 = 1
  /
\end{verbatim}

\begin{description}

\item[NMODES] Number of Jahn-Teller active modes in the state. Integer.

\item[TITLE] Title for the calculation. Does not need to be in quotes (they will be considered part of
  the name). 

\item[S] Value of the spin angular momentum for the state, must be
  zero, half-integer, or integer. This is checked and will throw an error if incorrect value is provided.

\item[AZETA] The value of $a\zeta _e$ in a spin-orbit state. If
  $a\zeta_e$ is zero, then the value of {\tt S} does not matter. Real.

\item[FIT\_AZETA] Whether or not to fit $a\zeta _e$ in the fitting
  routines. Boolean.

%\item[ZETAE] The value of $\zeta _e$ for the state, used only in the
%  calculation of the Coriolis coupling constant. Real.

\item[MAXJ] The maximum value of $j$ to be used in the
  calculation. For linear Jahn-Teller coupling only, this is the
  maximum value of $j$ for which the diagonalizations will be
  performed. For quadratic Jahn-Teller coupling calculations, this is
  the maximum value of $j$ to be included in the matrices. For
  quadratic \JT\ coupling, {\tt MAXJ} must be at least 7.5. This value
  must be half-integer or an error will be thrown. Real.

%\item[CALC\_DERIV] Boolean variable that determines whether the
%  derivatives of the energies with respect to the various parameters
%  (vibrational frequencies, coupling constants, etc.) should be
%  calculated. The calculation of the derivatives of the eigenvalues with
%  respect to the parameters has probably not been adequately tested,
%  and no guarantee is made that they are accurate. Boolean.
  \item[FIT\_ORIGIN] Boolean variable to fit origin or not. For some spectra the uncertainty in the origin may be large relative to the uncertainty in the positions of the vibronic transitions. In these cases the origin may be fit to eliminate systematic error arising from an incorrect frequency. Boolean.
  
  \item[ORIGIN] The offset of the origin relative to the assumed value used to generate the vibrational frequencies in the .fit file. Can also be used without fitting to make reported values match experimental values for excited electronic states by including the origin frequency. Real.
  
  
  \item[USE\_KAPPA\_ETA] Boolean variable that is true if $\kappa$ ({\tt KAPPA}) and 
  $\eta$ ({\tt ETA}) will be used for the linear and quadratic Jahn-Teller coupling
  terms instead of D and K. This is false by default and may be left out of the
  input file if D and K are to be used. There is a simple relationship between
  $\kappa$ and $\eta$ and D and K which was derived by John Stanton. Within
  \socjttwo\ these are converted to D and K. This is purely a matter of user convenience
  when $\kappa$ and $\eta$ would be easier to use. Boolean.

\item[S1] Value of s$_1$ according to equation (\ref{se and sv
    selection rule}). This choice has no bearing on the calculated
  energies of the spin-vibronic levels, only the relative phases of
  the electronic and vibrational contributions to the Coriolis
  coupling constant of each level. The value must be either 0 or 1. If any other value is used an error will be thrown. Integer. 

\item[S2] Value of s$_2$ according to equation (\ref{se and sv
    selection rule}). See above, and section \ref{section:limitations}
  for a discussion of the limitations on this parameter.

\end{description}

\subsection{\&MODE\_INFO}

For each vibrational mode, a {\tt \&MODE\_INFO} must exist, otherwise
default parameters are used that will cause spurious results for the
user. There must therefore be at least {\tt NMODES} {\tt \&MODE\_INFO} namelist groups in
the input file. If there are more than {\tt NMODES} {\tt \&MODE\_INFO} namelist groups the extras will be ignored. The default values are

\begin{verbatim}
 &MODE_INFO
  MODEVMAX = 0
  MODEOMEGA = 0.0
  MODEWEXE = 0.0
  MODED = 0.0
  MODEK = 0.0
  FIT_OMEGA = FALSE
  FIT_D = FALSE
  FIT_K = FALSE
  FIT_WEXE = FALSE
  ISATYPE = FALSE
  MODEA_OMEGA = 0.0
  /
\end{verbatim}

If {\tt USE\_KAPPA\_ETA = TRUE} in the {\tt \&GENERAL} section, then replace {\tt MODED}, {\tt MODEK}, {\tt FIT\_D}, and {\tt FIT\_K} by the following.

\begin{verbatim}
  KAPPA = 0.0
  ETA = 0.0
  FIT_KAPPA = FALSE
  FIT_ETA = FALSE
\end{verbatim}

\begin{description}

\item[MODEVMAX] Maximum value of v for this vibrational mode. In
  general, the lower the vibrational frequency and the larger the \JT\
  coupling constants, the larger this number needs to be. A negative value will throw an error.

\item[MODEOMEGA] Vibrational frequency, in \wn , for the mode. A negative value will throw an error. Real.

\item[MODEWEXE] Anharmonicity for the mode, in \wn . Real.

\item[MODED] Linear \JT\ coupling constant for the mode, as defined in
  equations (\ref{E min, no spin orbit}) to (\ref{E max, no spin
    orbit}). This value is usually considered to be positive. A negative value will throw an error. Dimensionless, real.

\item[MODEK] Quadratic \JT\ coupling constant for the mode, as
  defined in equations (\ref{E min, no spin orbit}) to (\ref{E max, no spin
    orbit}). While D$_i$ is positive, K$_i$ can be either positive or
  negative. The choice has no effect on the calcualted energy levels,
  but does swap the symmetries of the $j=\frac{3}{2}$ levels split by
  the quadratic interaction. These symmetries are sometimes not able to be
  determined experimentally, in which case the sign of K$_i$ has
  no meaning. Dimensionless, real.

\item[FIT\_OMEGA,FIT\_D,FIT\_K,FIT\_WEXE,FIT\_KAPPA,FIT\_ETA] Whether to fit these
  parameters in the fitting routine.  All boolean.
  
\item[ISATYPE] Boolean value to indicate if this mode is a degenerate (default) or
  nondegenerate (A type). If TRUE, then the mode is treated a nondegenerate for the purposes
  of building the basis set and any values entered for {\tt D} or {\tt K} ({\tt ETA} or {\tt KAPPA}) are ignored. Boolean.

\item[MODEA\_OMEGA] The value of the vibrational frequency of this
  mode in the non-degenerate state to or from which electronic
  transitions occur. This parameter is used only in the calculation of
  the relative intensities of the vibrational progressions in the
  electronic spectra, and in the files generated to produce
  simulations of these spectra. Real, \wn .

%\item[MODEZETA] The Coriolis coupling constant for this vibrational
%  mode, used only in the calculation of the Coriolis coupling constant
%  for the (spin-)vibronic level. Dimensionless, real.

\end{description}

\subsection{\&SOLVE\_INFO}

The {\tt \&SOLVE\_INFO} namelist group contains parameters used in the
diagonalization routines. In general, the default values should be
adequate for the simple Lanczos routine, which is the default, except for M,
which the user must choose. 

There is the option of using either a block Lanczos routine (Underwood method) or a simple Lanczos routine. The block routine
uses full reorthogonalization and generates the eigenvectors during the routine
automatically. The benefits of this routine are that it is guaranteed to find all
of the eigenvalues with no spurious values and if the eigenvectors are requested
it does not take any extra time to do so.  The drawback of this routine is that it
may take up to 100x longer than the simple Lanczos routine. For the block routine
{\tt K\_FACTOR} is the size of the blocks used, {\tt NOITS} is the maximum number of iterations
that will run and {\tt TOL} is the tolerance used to define when an eigenpair has converged.
When using the block routine, the runtime may be dependent upon {\tt K\_FACTOR} and while
I have found 2 to be adequate in most cases a larger value may run faster.  For a 
larger {\tt K\_FACTOR} less iterations will be required but they will take longer.  The routine
completes when either {\tt NOITS} is exceeded or all eigenvalues requested converge to the 
specified tolerance.

For the simple Lanczos routine {\tt K\_FACTOR} is not used and the other parameters described above
have slightly different uses. {\tt NOITS} is the number of Lanczos iterations run, and therefore, the
size of the Lanczos matrix generated. This routine uses numerically stable versions of the Lanczos recursions (CITE CULLUM) but does not use any orthogonalization so some
eigenvalues will be repeats and others will be spurious values which do not correspond to actual
eigenvalues of the Hamiltonian. These duplicate and spurious values are removed after diagonalization. {\tt M} is the same as for the block routine and specifies how many eigenvalues should be calculated. {\tt TOL} for the simple Lanczos is used
in the test to remove duplicate and spurious eigenvalues. Any eigenvalue within {\tt TOL} of another
is removed as a duplicate and this is the same test used to remove spurious values. A value
of 10$^{-6}$ works for most cases but it may be necessary to use a smaller value. This test may cause eigenvalues which are degenerate within {\tt TOL} with another eigenvalue of the same symmetry to be wrongly discarded. This is unfortunately unavoidable since we are using the Cullum test to remove spurious eigenvalues.

Defaults are

\begin{verbatim}
 &SOLVE_INFO
  M = 10
  K_FACTOR = 2
  NOITS = 2000
  TOL = 0.000001
  PARVEC = 1
  PARMAT = 1
  PARJ = 2
  BLOCK_LANCZOS = F
  /
\end{verbatim}

\begin{description}
\item[M] Number of eigenvalues to find in each block. Integer.

\item[K\_FACTOR] The block Lanczos routine uses blocks with 
  K\_FACTOR columns. The larger K\_FACTOR is the fewer iterations
  the routine will take to converge but the longer each iteration
  will take to run. Not used in the simple Lanczos routine. Integer.

\item[NOITS] Maximum number of iterations the eigenvalue routines
  will perform for each block. If the calculation stops because it has
  reached {\tt noits}, the output will include the eigenvalues and
  eigenvectors found to that point. This can then serve as a guide for
  how many iterations might be necessary. This is the number of Lanczos
  iterations in the simple Lanczos routine. Integer.

\item[TOL] This is the relative tolerance to which
  the eigenvalues are found, such that $\frac{\Delta \epsilon
    }{\epsilon } < ${\tt TOL}. A value of {\tt TOL} less than 0.000001 is highly
  recommended, as this will, in general, result in energies calculated
  to within 0.1 \wn . For the simple Lanczos a value not larger than 10$^{-6}$
  should be used. Real.
  
\item[PARVEC] This is the degree of parallelization to be used in
  the matrix-vector multiplactions in the Lanczos routines. In 
  practice a value of 2 or larger is only useful for basis sets larger than
  a few hundered thousand basis functions. Otherwise it will run
  fastest with the default value of 1. Integer.

\item[PARMAT] This is the degree of parallelization to be used in
  the matrix generation routine for each j block. As long as there are
  a sufficient number of processors the matrix generation speed 
  will increase almost linearly with the value of {\tt PARMAT}. Integer.

\item[PARJ] This is the degree of parallelization to be used for
  the different j blocks.  Because each j block will call a matrix
  generation routine and a diagonalization routine the total number
  of processors used will be {\tt PARJ} times {\tt PARVEC} and {\tt PARMAT}. Integer.

\item[BLOCK\_LANCZOS] Boolean value to indicate if the block Lanczos
  routine should be used. Boolean.

\end{description}

\subsection{\&IO\_INFO}

The {\tt \&IO\_INFO} namelist group contains Boolean variables that
indicate whether a particular piece of output is desired as well
as how the eigenvectors should be printed. Defaults are

\begin{verbatim}
 &IO_INFO
  PRINT_BASIS = FALSE
  PRINT_VEC = FALSE
  PRINT_MATRIX = FALSE
  USE_MATRIX_FILE = FALSE
  MATRIX_FILE = matrix.txt
  VEC_FILE = FALSE
  VEC_FILE_COMPLETE = FALSE
  EV_MIN = 0.2
  /
\end{verbatim}

\begin{description}

\item[PRINT\_BASIS] Whether or not to include in the output the basis
  set for each block. Boolean.

\item[PRINT\_VEC] Whether or not to include in the output the eigenvectors
  for each block. The eigenvalues, Ham reduction factors, and Coriolis
  constants are part of the output whether {\tt PRINT\_VEC} is true or
  false. Boolean.

\item[PRINT\_MATRIX] Whether or not to include in the output the Hamiltonian
  matrix for each block. Boolean.
  
  \item[USE\_MATRIX\_FILE] Whether or not the Hamiltonian should be read from file instead of generated or, if not already made, written to file for future use. Boolean.
  
  \item[MATRIX\_FILE] Name of the file with the Hamiltonian stored. This file is generated by \socjttwo\ and stores the off diagonal elements of the Hamiltonian by $j$-block and parameter. What is stored is the position and value of the matrix element \emph{with the parameter set equal to 1}. The purpose of this is to allow the user to perform multiple calculations with the same size basis set but possibly different values of the coupling parameters without needing to regenerate the Hamiltonian from scratch each time. If {\tt USE\_MATRIX\_FILE} is {\tt TRUE} and the specified {\tt MATRIX\_FILE} does not exist it will be generated and saved to disk for future use. Then, if a calculation with the same basis set is used the user may opt to read this Hamiltonian from disk instead of regenerating it which is generally much faster, particularly for large basis sets. 
  
\item[EV\_MIN] The minimum value of the weight for a basis function to be 
  printed in the eigenvectors. Double.

\item[VEC\_FILE] If {\tt TRUE} a separate file with the eigenvectors will be created. The name of this file will be the {\tt \&TITLE} from the {\tt \&GENERAL} \&NAMESPACE plus ``\_vec.out'' This prints all coefficients, not just those larger than {\tt \&EV\_MIN}. Boolean.

\item[VEC\_FILE\_COMPLETE] If {\tt TRUE} a file similar to that for {\tt VEC\_FILE} will be created. The difference is that the complete basis set is used in this output file. Since the Hamiltonian is block diagonal and many basis functions will never have nonzero values by symmetry typically only a portion of the possible basis functions are included in the calculation. However, in some cases it may be beneficial to have the entire basis set. I mostly used this for comparisons to John Stanton's \ai\ calculations. The name of this file will be the {\tt \&TITLE} from the {\tt \&GENERAL} \&NAMESPACE plus ``\_CompleteVector.out'' Boolean.
\end{description}


\subsection{\&FIT\_INFO} \label{fitinfo}

The {\tt \&FIT\_INFO} namelist group controls the fitting portion of \socjttwo
. See section \ref{section:fitting} for more information. The default values are

\begin{verbatim}
 &FIT_INFO
  FITFILE = fit.fit
  FTOL = 0.0
  XTOL = 0.0
  GTOL = 0.0
  MAXFEV = 25
  FACTOR = 0.001
 /
\end{verbatim}

\begin{description}

\item[FITFILE] The name of the file that contains the energy levels
  to be fit and their assignments.  See section \ref{section:fitting:file} for
  the formatting of this file. String.

\item[FTOL, XTOL, and GTOL] To quote from the lmder.f
  literature regarding these three parameters:
  \begin{verbatim}
  ftol is a nonnegative input variable. Termination occurs when both
the actual and predicted relative reductions in the sum of squares are
at most ftol. Therefore, ftol measures the relative error desired in
the sum of squares. 

  xtol is a nonnegative input variable. Termination occurs when the
relative error between two consecutive iterates is at most
xtol. Therefore, xtol measures the relative error desired in the
approximate solution. 

  gtol is a nonnegative input variable. Termination occurs when the
cosine of the angle between fvec and any column of the jacobian is at
most gtol in absolute value. Therefore, gtol measures the
orthogonality desired between the function vector and the columns of
the jacobian. 
 \end{verbatim}

 The smaller these three numbers are, the tighter the parameters will
 be converged. See section \ref{section:fitting} for more
 information regarding these parameters. All real.
 
 More information for these can be found in the documentation for the Levenberg-Marquardt algorithm at ALGLIB.net.\cite{alglib}

\item[MAXFEV] Maximum number of iterations for the fitting
  procedure. Integer.

\item[FACTOR] Essentially the step size the fitting procedure takes
  between successive iterations. A value of {\tt FACTOR} greater than 1 or
  so will almost invariably cause wild and useless results. A small
  step size will take longer to converge, and may converge to a
  solution that is a local minimum. Real.

\end{description}

\subsection{\&CROSS\_TERMS} The {\tt \&CROSS\_TERMS} namelist group specifies
any coupling terms between two modes and whether they are to be fit.

\begin{verbatim}
 &CROSS_TERMS
  JT MODE 1 MODE 2 100.0
  FIT = FALSE
 /
\end{verbatim}

\begin{description}
\item[JT] The string JT should be first which says this is a Jahn-Teller type cross-term.
Next, the two modes coupled by this term should be given as {\tt MODE x MODE y}. 
The last term is the value of the cross-term between the two modes. Double.

\item[FIT] Boolean value indicating whether the cross-term on the preceding line
should be fit. This line is optional and has a default value of {\tt FALSE}.

\end{description}

\subsection{\&SCAN} \label{scan}

The {\tt \&SCAN} namelist is optional and is only needed if one or more parameters
are being scanned. Any number of parameters may be scanned simultaneously.

\begin{verbatim}
 &SCAN
  STEPS = 10
  MODE 1 D 0.0 0.1
  MODE 1 K 0.01 0.02
  MODE 2 OMEGA 540.0 -5.0
  CROSS 1 2 B 0.01 2.0
 /
\end{verbatim}

\begin{description}
\item[STEPS] This indicates how many steps should be done in the scan.
Integer.

\item[MODE] Lines starting with {\tt MODE} indicate which parameters are being 
scanned. The first value beyond {\tt MODE} must be an integer which is the mode
whose parameter is being scanned. Modes are labeled numerically in the order
in which they are in the input file. The next value is a string which may be
{\tt OMEGA, WEXE, D} or {\tt K} and says which variable is being scanned. After that 
is a double value giving the starting value of the parameter. The final
item is a double giving the step size of the parameter each iteration. 
The step size may be positive or negative.

\item[CROSS] If cross-terms are to be scanned the line must start with 
{\tt CROSS}. The next two values are integers indicating which modes are coupled.
{\tt B} indicates that this is a Bilinear coupling term (the only type
of cross-terms currently implemented). The last two elements are the starting
value and step size respectively.

\end{description}

When doing a scan all fit booleans are set to false automatically. It is important
that if fitting a cross-term or quadratic JT term their starting value should not
be exactly 0. Not doing so will cause the comparison of final results difficult and may
cause errors.

\section{Output} \label{section:output}

\subsection{Output of \socjttwo }

The description of the output file uses as its example the output of
the {\tt test.txt} input file contained in the file
distribution. Hopefully the examples and accompanying descriptions are
sufficient to explain the output. The name of the output file is {\tt
  filename.out}, where {\tt filename} is the name of the input file.

\subsubsection{Preamble}

The output of the main program \socjttwo\ begins with the {\tt \&GENERAL} and {\tt \&MODE\_INFO} and all other relavent namelist groups
from the input file. 

This is immediately followed by a time report for the matrix generation and Lanczos routine. These times represent the total time for the Hamiltonian generation function and Lanczos routines for all $j$-blocks.

\begin{verbatim}
Time Report:
Matrix generation took       0.14 seconds.
The Lanczos routines took       1.94 seconds.
\end{verbatim}

%The numbering of the modes in the table are based on the order of the
%\&MODE\_INFO namelist groups in the input file. The numbering given in
%the table will be the numbering of the vibrational modes for the rest
%of the output file.

%The column of the table entitled {\tt JTSE} is the Jahn-Teller
%stabilization energy for the mode; i.e., it is the energy of equation
%(\ref{def of epsilon1}), and does not include the effects of
%spin-orbit or quadratic \JT\ coupling.



\subsubsection{Each $j$ block}

At this point, the output begins to cycle through all of the blocks of
the Hamiltonian, beginning with $j=\frac{1}{2} $ and working up to
{\tt maxj}. Each block is begun by a header, such as
\begin{verbatim}
 
J = 0.5
Sigma = -0.5
 
\end{verbatim}

which lists the value of $j$ and Sigma for the information which follows. For linear JT problems the value of $j$ listed is straightforward. For quadratic JT problems there will only be two $j$ blocks listed which are 0.5 and 1.5. Since $j$ is not a good quantum number these are the two symmetry blocks, $e$ and $a_1, a_2$ respectively for molecules with a 3-fold axis of symmetry.

\paragraph{Eigenvalues}
This is followed by the eigenvalues for this $j$-block listed in ascending order.

\begin{verbatim}

	-4496.0158
	-3753.9625
	-3327.7389
	-3149.8039
	-3011.9181
	-2589.5634
	-2407.2378
	-2313.2245
	-2269.8802
	-1949.2045
	-1855.8557
	-1850.9386
	-1664.3674
	-1562.2320
	-1527.8450
	-1207.4203
	-1166.3317
	-1113.0771
	-1111.8316
	 -921.2819
	 
\end{verbatim}

And then the number of basis functions, nonzero matrix elements and how many iterations the Lanczos routine took. The number of nonzero matrix elements is actually the number of elements on the diagonal and the upper triangle only. 

\begin{verbatim}
 
Number of basis functions: 2211
Number of non-zero matrix elements: 19711
 
Lanczos routine took 2500 iterations to complete.

\end{verbatim}

\paragraph{Eigenvectors}
The eigenvectors are listed next. The eigenvalue is listed in the first line and then the coefficient minimum is stated. The next line says {\tt Vector is Type} and then either the number 1 or 2. This refers to the symmetry of the eigenvector with respect to the sign of the coefficients of basis functions with the same values of v but values of l and lambda differing by a factor of -1. If the coefficients have the same sign it is listed as Type 1, and if they have opposite sign it is listed as Type 1. This is primarily useful in the $j$-blocks with $a_1/a_2$ symmetry since they will be Type 1 and Type 2 respectively. This determination is made by finding the largest coefficient in the eigenvector and then finding its `partner,' which is the basis function with all v values the same and all angular momentum terms having an opposite sign. The signs of these two basis functions are used for the determination. I have probably not tested this as well as I ought to have but it seems to have been correct so far.

\begin{verbatim}
 
Eigenvalue	1 = -4496.0158 

Eigenvector: (Only vectors with coefficients larger than 0.1 are shown)
 
Vector is Type 2
 
Coefficient	v(1)	l(1)	v(2)	l(2) lambda	
 -0.125926	  0	  	0	  	2	 	-2	  -1	
  0.149059	  0	  	0	  	3	 	-3	   1	
 -0.201217	  0	  	0	  	4	 	-2	  -1	
  0.194645	  0	  	0	  	5	 	-3	   1	
 -0.199012	  0	  	0	  	6	 	-2	  -1	
  0.168118	  0	  	0	  	7	 	-3	   1	
 -0.148091	  0	  	0	  	8	 	-2	  -1	
  0.113444	  0	  	0	  	9	 	-3	   1	
 -0.163008	  0	  	0	  	1	  	1	  -1	
  0.232706	  0	  	0	  	2	  	0	   1	
 -0.268804	  0	  	0	  	3	  	1	  -1	
  0.287202	  0	  	0	  	4	  	0	   1	
 -0.275230	  0	  	0	  	5	  	1	  -1	
  0.251192	  0	  	0	  	6	  	0	   1	
 -0.212858	  0	  	0	  	7	  	1	  -1	
  0.174573	  0	  	0	  	8	  	0	   1	
 -0.135180	  0	  	0	  	9	  	1	  -1	
  0.102294	  0	  	0	  	10	  0	   1	
  0.109817	  0	  	0	  	3	  	3	   1	
 -0.118085	  0	  	0	  	4	  	4	  -1	
  0.158248	  0	  	0	  	5	  	3	   1	
 -0.143477	  0	  	0	  	6	  	4	  -1	
  0.145425	  0	  	0	  	7	  	3	   1	
 -0.116949	  0	  	0	  	8	  	4	  -1	
  0.102188	  0	  	0	  	9	  	3	   1

\end{verbatim}

\paragraph{Basis set}
The next section of the output is the listing of each basis function
included in this block of the Hamiltonian, and is only printed if the
value of {\tt print\_basis} has been set to {\tt TRUE}. The output is of
the form
\begin{verbatim}
Basis Fxn #	v(1)	l(1)	v(2)	l(2)	lambda	Sigma	
    1         0	   0	  14	 -14	  -1	   -0.5	
	...	
\end{verbatim}
and continues through all of the basis functions. The columns give the
principal quantum number $v_i$ and the vibrational angular quantum
number $l_i$. For nondegenerate modes which have no angular momentum, $l_i$ is still printed but is 0 for all entries. The column {\tt lambda} is the value of $\Lambda $ for
the basis set, and the column {\tt Sigma} is the value of
$\Sigma $.

\paragraph{Hamiltonian matrix}
After the basis set. This
number is actually the number of non-zero matrix elements in the upper
half of the matrix. If the value of {\tt PRINT\_MATRIX} has been set to
{\tt TRUE} then all of the non-zero matrix elements will be printed
out,
\begin{verbatim}
	Hamiltonian Matrix
	Only upper triangle given
Row  Column    Value
1      1    21909.2051
1     12    14090.8974
1     13      273.8613
1    144     2363.3176
1    166     1310.9328
1    188      247.7430
2      2    22659.2051
2     12      273.8613
\end{verbatim}
The column and row numbers correspond to the indices of the matrix,
which are the basis functions listed previously in the output. The
values are listed in units of \wn .

\paragraph{Possible diagonalization errors}
If the diagonalization was not successful, an error message will be
given indicating what the problem was. For the most part, the only
error message that will be encountered in normal practice in the
message indicating the maximum number of iterations was exceeded. In
this case, the calculation should be resubmitted with a larger value
of {\tt NOITS}. Even if an error was
encountered, the eigenvalues and eigenvectors for the solutions that
were found will be listed.

%\paragraph{Eigenvalues and eigenvectors}
%Hopefully, though, the next lines in the output will be
%\begin{verbatim}
% Underwood method completed successfully.
% Final results for j =  .5 and Sigma =  -.5
%\end{verbatim}
%(``Underwood'' is the type of diagonalization routine used.) The next
%section of the output lists the eigenvalues that were found as
%solutions,
%\begin{verbatim}
%Found 11 eigenvalues
%--------------------
%     649.146200
%     979.415800
%    1165.737000
%    1253.750000
%    1386.468000
%    1487.378000
%    1526.489000
%    1745.356000
%    1778.216000
%    1792.343000
%    1821.780000
%\end{verbatim}
%These eigenvalues are in units of \wn , and are relative to the
%undistorted point of the PES being defined as the zero of energy. The
%final portion of the output file is a list of all of the eigenvalues
%found, with the zero of energy being set to the energy of the lowest
%energy (spin-)vibronic solution.


\subsubsection{Calculation summary}
After the last $j$ block has been computed, the results of the
calculation are summarized.
\begin{verbatim} 

#	Final results showing all eigenvalues found
    Eigenvalue    j    Sigma    n_j    Symm
1      0.0000    0.5    -0.5     1     2
2      7.1459    1.5    -0.5     1     2
...
39  3483.0628    1.5    -0.5    20     1
40  3574.7339    0.5    -0.5    20     2

 
SOCJT 2 has completed. Total time elapsed =      5.9420 seconds.
\end{verbatim}
The column for {\tt Symm} will only be included if either the Block Lanczos (Underwood) routine is used or the {\tt PRINT\_VEC} flag is set to {\tt TRUE}. In this final listing the eigenvalues have been adjusted so that the lowest energy eigenvalue is set to 0 plus the value of {\tt ORIGIN}. The last line is the total time elapsed. This may be slightly more than the sum of the times for the Hamiltonian generation and Lanczos routine because of time spent generating the basis set and parsing the input/output files.

\subsection{Fitting output}

When the non-linear least squares routines are used, \socjttwo\ is
executed at least once for each iteration of the fitting routine. Since numerical derivatives are calculated for each parameter being fit the \socjttwo\ routine may run many times for a given iteration. Secant updates are used to build a model of the Jacobian which is recalculated only when the model is found to be wrong. For more information see the documentation of the Levenberg-Marquardt optimizer at ALGLIB.net\cite{alglib}. At the end of
the fitting, output similar to the following is generated:
\begin{verbatim}
Fit report below...
Termination Type: 
Relative step is no more than EpsX 
Number of iterations: 5
Number of times the eigenvalues were calculated: 62
 
A * zeta e = 0
Final Parameters for Each Mode:
Mode #  V(min) V(max)   Omega(E)   wexe      D        K      JTSE   Omega(A)  A Type?
1          0     25     1435.59    0.00   3.2114   0.2441   5735.45   239.00    False
2          0      8      528.21    0.00   0.0000   0.0219      0.00   239.00    False
  
  
Fitting Results:
FitFile Value	Calculated Value	Exp - Calc	(Exp - Calc)^2
        8.000	        8.170		   -0.170	      0.029
      539.500	      533.912		    5.588	     31.226
      539.300	      539.274		    0.026	      0.001
     1056.600	     1056.346		    0.254	      0.065
     1069.400	     1070.955		   -1.555	      2.418
     1156.300	     1157.995		   -1.695	      2.874
     1270.500	     1270.705		   -0.205	      0.042
     1347.400	     1347.182		    0.218	      0.048
     1602.800	     1604.364		   -1.564	      2.447
     1693.400	     1691.722		    1.678	      2.817
  
RMS Error =      2.049
  
Mode 1 Omega StdDev =       1.51
Mode 1 D StdDev =     0.0191
Mode 1 K StdDev =     0.0005
Mode 2 Omega StdDev =       0.56
Mode 2 D StdDev =     0.0295
Mode 2 K StdDev =     0.0040
 
Correlation coefficient matrix:

(   1.000,    -0.762,    -0.803,     0.291,     0.614,     0.464)
(  -0.762,     1.000,     0.578,    -0.392,    -0.835,    -0.682)
(  -0.803,     0.578,     1.000,    -0.328,    -0.684,    -0.528)
(   0.291,    -0.392,    -0.328,     1.000,     0.479,    -0.051)
(   0.614,    -0.835,    -0.684,     0.479,     1.000,     0.821)
(   0.464,    -0.682,    -0.528,    -0.051,     0.821,     1.000) 
\end{verbatim}

The termination type is listed as one of the stopping conditions being met which may be one of the tolerance values in the input file or the maximum number of iterations was reached. The number of iterations is actually the number of steps the optimizer took while the number of times the eigenvalues were calculated is how many times the main \socjttwo\ routine was run. In the event that the block Lanczos routine is not used and the eigenvectors are requested they will only be calculated at the end of the fit in order to save time. Additionally, the Hamiltonian is only generated once, at the first iteration, and then stored in such a way that it may be quickly regenerated by multiplying it by the appropriate parameter.

The covariance matrix is estimated from the Jacobian and the uncertainties of the best fit parameters are taken as the square roots of the diagonal entries in the covariance matrix. This is also used to generate the correlation matrix. The rows and columns of this matrix follow the same order as the uncertainties.

Following this table, all of the namelist groups are printed with the
final fit values, so that these lines can be copied into an input file
and the program started from these values.

%\subsection{Auxiliary files} \label{section:outputaux}

%There are several additional files that may be generated by \socjt :
%{\tt filename.uv.\#.txt}, {\tt filename.basis.}$j.\Sigma $, and {\tt
%  filename.vecs.}$j\Sigma $. The filenames are constructed by
%appending brief notations to the {\tt filename} of the input file. For
%the electronic transition intensites, the files are numbered according
%to the \&UV\_INFO namelist groups. The basis set and vector files,
%used in subsequent calculations by \socjt\ (as guesses to the
%diagonalization routines) or by \etoe\ have a slightly more
%complicated format. Following the appendation of {\tt .basis.} or {\tt
%  .vecs.}, the value of $j$ is appended. If spin-orbit coupling was
%included in the calculation, a ``{\tt m}'' or ``{\tt p}'' is appended
%to indicate the sign of the value of $\Sigma $, which follows, for the
%basis set or eigenvectors that are being written. While cumbersome,
%these filenames allow for all of the required information to be stored
%in a useable format.


\paragraph{Basis set and vector files}

If the formatting of these files is desired, please contact the
authors directly. These files are created so that the initial guess
functionality of \socjt\ works and so that the program \etoe\ has all
of the information it needs to calculate transition intensities
between two degenerate states.

\section{How to use SOCJT 2} \label{section:howto}

\subsection{Executing the program}
To execute \socjttwo , you should change to the directory {\tt SOCJT 2.exe} is in, and double click the application. All files you wish to run must also be in the same directory. The program immediately prompts the user
with the following question,
\begin{verbatim}
Enter file name including extenstion:
\end{verbatim}
The filename should be the name of the input file with the file extension (usually .txt). The next prompt says ,
\begin{verbatim}
Enter output file name or press enter to use `filename.extension'.out:
\end{verbatim}

where filename.extension is what was entered in the first prompt. It is usually fine to just hit enter here but you have the option of giving a unique output file name if desired. All of the output and
auxiliary files that are generated are plain text files and can be
viewed with any standard text editor. There are no binary files
associated with \socjt .

\subsection{Execution times}
The time required for execution scales exponentially with the size of
the basis set. It is recommended that the user perform preliminary
calculations with smaller basis sets, and then work up to bigger basis
sets. The block-Lanczos routine (from \socjt) can take more than 100
times longer than the simple Lanczos routine written for \socjttwo\ so
it is recommended to use the simple Lanczos whenever possible and only
use the block routine to double check results. For example, a quadratic JT problem with $\sim$8800 basis functions took 180 s using the block Lanczos 
algorithm while it took only 2.7 s using the simple Lanczos. Hamiltonian
generation times scale quadratically with basis set size and may represent
the majority of execution time for large basis sets. For example, a problem with $\sim$450,000 basis functions took $\sim$1400 s to generate (using PARMAT = 4, PARJ = 2) the matrix but only $\sim$120 s to diagonalize with the simple Lanczos algorithm. All time tests were run on a machine with duo quad-core Intel Xeon processors at 2.6 GHz with 6 GB RAM. A final note is that execution times for the simple Lanczos routine increase, sometimes dramatically, when eigenvectors are requested. This is because, unlike the block Lanczos routine which automatically generates eigenvectors, they must be explicitly calculated by transforming the eigenvectors of the Lanczos matrix to those of the Hamiltonian by multiplying them by the Lanczos vectors. This means you have M matrix vector products of a matrix with dimension N (the size of the basis set) x NOITS times a vector of size N. This can take even longer if the Lanczos vectors are so large that they may not be stored in memory. In that case, which is hard coded for basis sets $>$40,000, the Lanczos vectors must be written to file at each iteration and then read from file in order to do the transformation.

\subsection{Recommendations on input parameters}
There are a few general recommendations regarding the choice of basis
set. First, in general, the larger the value of either $D_i$ or $K_i$,
the larger that mode's value of {\tt MODE\_VMAX} should be. This result is
fairly obvious. Second, the smaller the frequency $\omega _{e,i}$ is,
the larger the basis set should be. This result is not directly
obvious, but is derived from the experimental realization that most
information is available for the lower energy spin-vibronic levels,
and these levels will be dominated by the vibrational modes with low
frequencies. It is also important to vary the {\tt MAXJ} parameter, especially
for cases with strong JT coupling. For quadratic JT calculations a {\tt MAXJ}
value of at least 7.5 should be used but a larger basis set may
be necessary.

Lastly, and most importantly, it is important to recognize that the
choice of a finite basis set is a potentially severe
approximation. Thus, it is very important that a series of
calculations needs to be performed, with increasing size of the basis
set. This should be done by increasing both {\tt VMAX} and {\tt MAXJ}. For fitting spectra, it may be wise to run initial calculations with a moderate sized basis set; meaning a basis set which converges to within a few \wn\ of the infinite basis set limit. As the fit to the experimental data improves, fewer iterations of the fitting routine will be necessary and the basis set can be increased without incurring a huge time cost.

\subsection{Degeneracies}
One subtlety that is often not appreciated is that every single level
is at least doubly degenerate. However, we only calculate one spin
component for each energy. To make things simple, we have calculated
only those levels with positive $j$. There is of course a degenerate
component, but we neglect it. See equation 76 of reference \citen{barckholtz}.

\subsection{Non-linear least squares fitting} \label{section:fitting}

If any of the parameters {\tt FIT\_AZETA}, {\tt FIT\_OMEGA}, {\tt FIT\_D}, {\tt FIT\_K},
or {\tt FIT\_WEXE} are true, then the fitting routines will be executed. If
they are all false, then the eigenvalues will be computed only once,
and the program will be terminated. The fitting routines invoke a Levenberg-Marquardt
non-linear least squares algorithm from the ALGLIB library\cite{alglib} to optimize the input parameters. The fitting
procedures use as their starting point the values of $a\zeta _e$,
$\omega _{e,i}$, and so on that are given in the input file.

It is important to note that for most realistic cases, there is
probably not one unique ``best fit'' of the experimental data. The
multimode \JT\ problem is extremely complicated, and it is quite
likely that a number of ``local minima'' exist that can fit the data
reasonably well. Therefore, the choice of input parameters will
strongly influence the fitting results. We recommend the use of \ai\
calculations to guide the choice of vibrational frequencies, linear
\JT\ coupling constants, and spin-orbit coupling constant. See
reference \citen{A-bar-e001} for more details of \ai\ calculations of the
\JT\ surface.

\subsubsection{The format of fitfile} \label{section:fitting:file}

An additional file, named {\tt FITFILE}, is required if a fit is being run and must be ins the same director as the input file. It contains a list
of the eigenvalues and quantum number assignments of the energy levels to
be fit. These energies are all relative to the ``vibrationless''
energy level being defined as the value of the {\tt ORIGIN} parameter in the input file (usually 0). This file is of the format 
\begin{verbatim}
11
    7.96   0.5  1  0.5
  155.30   1.5  1 -0.5
.
.
.
  496.59   0.5  4  0.5
  499.06   0.5  4 -0.5  
\end{verbatim}
The first line of the file contains the number of energy levels to be
fit, in this case 11.  There are then that many lines following with
the energy, $j$ value, $n_j$, and the value of $\Sigma $.  There are not formatting guidelines beyond the fact that the parameters must be in this order and have appropriate values (half integer for $j$ and $\Sigma$, integer for $n_j$).

The three ``quantum numbers'' $j$,
$n_j$, and $\Sigma $ define each unique energy level, and can be found
at the end of the output of a \socjttwo\ run.


\bibliographystyle{unsrt}
\bibliography{SOCJT_BIB}

\end{document}

